{% extends 'base.html' %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h4><i class="fas fa-search"></i> Find Blood Donors</h4>
    </div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Blood Group</label>
                <select name="blood_group" class="form-control">
                    <option value="">All Blood Groups</option>
                    {% for bg in blood_groups %}
                        <option value="{{ bg }}" {% if bg == selected_blood_group %}selected{% endif %}>
                            {{ bg }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">District</label>
                <input type="text" name="district" class="form-control" 
                       placeholder="Enter district" value="{{ selected_district }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Upazila</label>
                <input type="text" name="upazila" class="form-control" 
                       placeholder="Enter upazila" value="{{ selected_upazila }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary form-control">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </form>
    </div>
</div>

<div class="mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5><i class="fas fa-users"></i> Available Donors ({{ donors.count }})</h5>
        <a href="{% url 'register' %}" class="btn btn-outline-primary">
            <i class="fas fa-user-plus"></i> Register as Donor
        </a>
    </div>
    
    {% if donors %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Blood Group</th>
                        <th>Location</th>
                        <th>Status & Countdown</th>
                        <th>Contact Options</th>
                    </tr>
                </thead>
                <tbody>
                    {% for donor in donors %}
                        <tr>
                            <td>
                                <strong>{{ donor.full_name }}</strong><br>
                                <small class="text-muted">
                                    {% if donor.gender == 'Male' %}
                                        <i class="fas fa-mars"></i>
                                    {% elif donor.gender == 'Female' %}
                                        <i class="fas fa-venus"></i>
                                    {% else %}
                                        <i class="fas fa-genderless"></i>
                                    {% endif %}
                                    {{ donor.age }} years old
                                </small>
                            </td>
                            <td>
                                <span class="blood-group-badge">{{ donor.blood_group }}</span>
                            </td>
                            <td>
                                {{ donor.district }}<br>
                                <small class="text-muted">{{ donor.upazila }}</small>
                            </td>
                            <td>
                                {% if donor.is_eligible %}
                                    <span class="badge bg-success mb-1">
                                        <i class="fas fa-check-circle"></i> Eligible to Donate
                                    </span><br>
                                    <small class="text-success fw-bold">Ready to help!</small>
                                {% else %}
                                    <span class="badge bg-danger mb-1">
                                        <i class="fas fa-clock"></i> Not Eligible
                                    </span><br>
                                    <small class="text-muted">
                                        Available in: <strong>{{ donor.days_until_eligible }} days</strong>
                                    </small>
                                {% endif %}
                            </td>
                            <td>
                                <a href="tel:{{ donor.mobile_number }}" class="btn btn-sm btn-primary mb-1 w-100">
                                    <i class="fas fa-phone"></i> Call: {{ donor.mobile_number }}
                                </a><br>
                                
                                <a href="https://wa.me/88{{ donor.mobile_number }}?text=আসসালামু আলাইকুম, পটিয়া রেড-পালস (Patiya RedPulse) থেকে আপনার নম্বরটি পেয়েছি। আপনার {{ donor.blood_group }} রক্ত কি দান করা সম্ভব?" 
                                   target="_blank" 
                                   class="btn btn-sm btn-success w-100"
                                   style="background-color: #25D366; border-color: #25D366;">
                                    <i class="fab fa-whatsapp"></i> WhatsApp Message
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No donors found</h5>
            <p class="text-muted">Try adjusting your search criteria or check back later.</p>
            <a href="{% url 'register' %}" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Register as a Donor
            </a>
        </div>
    {% endif %}
</div>

<div class="card mt-4">
    <div class="card-header bg-light">
        <h6><i class="fas fa-info-circle"></i> Important Notes</h6>
    </div>
    <div class="card-body">
        <ul class="mb-0">
            <li><strong>Eligibility:</strong> Donors must wait 120 days between donations.</li>
            <li><strong>Countdown:</strong> The days shown indicate when the donor will be ready for the next donation.</li>
            <li><strong>WhatsApp:</strong> Use the WhatsApp button for quick communication if the donor doesn't pick up the call.</li>
        </ul>
    </div>
</div>
{% endblock %}
